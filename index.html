<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hiragana Harbor</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', sans-serif;
            background: linear-gradient(180deg, #a8d5e2 0%, #b8dfe8 50%, #c8e9ee 100%);
            min-height: 100vh;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 3em;
            color: white;
            margin-bottom: 8px;
            font-weight: 700;
            text-shadow: 2px 4px 8px rgba(0, 0, 0, 0.1);
            letter-spacing: 0.02em;
        }

        .header p {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1.1em;
            font-weight: 500;
        }

        .main-card {
            background: white;
            border-radius: 40px;
            padding: 45px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
        }

        .section-title {
            font-size: 1.3em;
            color: #5a6c7d;
            margin-bottom: 25px;
            font-weight: 600;
        }

        .column-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 18px;
            margin-bottom: 35px;
        }

        .column-card {
            background: white;
            border: 3px solid #b8dfe8;
            border-radius: 24px;
            padding: 28px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
            min-height: 140px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .column-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.12);
            border-color: #6eb5d1;
        }

        .column-card .char {
            font-size: 3.2em;
            color: #5a6c7d;
            font-weight: 500;
            margin-bottom: 8px;
        }

        .column-card .name {
            color: #7a8c9d;
            font-weight: 600;
            font-size: 0.85em;
            margin-bottom: 4px;
        }

        .column-card .count {
            color: #a8bfce;
            font-size: 0.75em;
        }

        .column-card .progress-mini {
            width: 80%;
            height: 4px;
            background: #e8f4f8;
            border-radius: 3px;
            margin-top: 10px;
            overflow: hidden;
        }

        .column-card .progress-mini-fill {
            height: 100%;
            background: linear-gradient(90deg, #5eb8d6, #4a9fc4);
            transition: width 0.3s ease;
        }

        .column-card .progress-text {
            color: #5eb8d6;
            font-size: 0.7em;
            margin-top: 4px;
            font-weight: 600;
        }

        .column-card .completion-badge {
            background: #4caf50;
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.7em;
            margin-top: 6px;
            display: inline-block;
        }

        .practice-all-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 20px;
            margin-top: 35px;
        }

        .practice-all-btn {
            background: linear-gradient(135deg, #5eb8d6 0%, #6495ed 100%);
            color: white;
            border: none;
            border-radius: 24px;
            padding: 24px 50px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 8px 25px rgba(94, 184, 214, 0.3);
            flex: 1;
            text-align: center;
        }

        .practice-all-btn:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 35px rgba(94, 184, 214, 0.4);
        }

        .practice-all-btn .title {
            font-size: 1.4em;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .practice-all-btn .subtitle {
            font-size: 0.9em;
            opacity: 0.95;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
        }

        .action-btn {
            background: white;
            border: 3px solid #b8dfe8;
            width: 90px;
            height: 90px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-align: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .action-btn:hover {
            transform: translateY(-4px);
            border-color: #6eb5d1;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }

        .action-btn .icon {
            font-size: 2em;
        }

        .action-btn .label {
            color: #7a8c9d;
            font-weight: 600;
            font-size: 0.7em;
            line-height: 1.2;
        }

        .bottom-nav {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin-top: 30px;
        }

        .nav-item {
            color: rgba(255, 255, 255, 0.85);
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .nav-item:hover {
            color: white;
            transform: translateY(-2px);
        }

        .btn {
            background: linear-gradient(135deg, #5eb8d6 0%, #6495ed 100%);
            color: white;
            border: none;
            padding: 18px 40px;
            border-radius: 18px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 700;
            width: 100%;
            box-shadow: 0 6px 24px rgba(94, 184, 214, 0.35);
            position: relative;
            overflow: hidden;
            letter-spacing: 0.02em;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.6s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 35px rgba(94, 184, 214, 0.45);
        }

        .btn:active {
            transform: translateY(-1px);
            box-shadow: 0 4px 20px rgba(94, 184, 214, 0.35);
        }

        .btn-secondary {
            background: white;
            color: #5eb8d6;
            border: 3px solid #5eb8d6;
            box-shadow: 0 4px 15px rgba(94, 184, 214, 0.15);
            font-weight: 600;
        }

        .btn-secondary:hover {
            background: linear-gradient(135deg, #f0f9fc 0%, #e8f4f8 100%);
            border-color: #4a9fc4;
            box-shadow: 0 6px 25px rgba(94, 184, 214, 0.25);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: 0 2px 8px rgba(94, 184, 214, 0.15);
        }

        .hidden {
            display: none;
        }

        /* Study Screen Styles */
        .card {
            background: white;
            border-radius: 28px;
            padding: 35px;
            margin-bottom: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.08);
        }

        .walkthrough-container {
            text-align: center;
            padding: 40px 20px;
        }

        .walkthrough-char {
            font-size: 10em;
            color: #5eb8d6;
            margin: 40px 0 30px 0;
            font-weight: 500;
            text-shadow: 0 4px 12px rgba(94, 184, 214, 0.2);
        }

        .walkthrough-romaji {
            font-size: 3em;
            color: #6495ed;
            font-weight: 600;
            margin: 20px 0;
            letter-spacing: 0.05em;
        }

        .walkthrough-tip {
            font-size: 1.05em;
            color: #5a6c7d;
            margin: 30px auto;
            padding: 20px 30px;
            background: linear-gradient(135deg, #e8f4f8 0%, #f0f8fb 100%);
            border-radius: 16px;
            max-width: 500px;
            border: 2px solid #d0e8f0;
            line-height: 1.6;
        }

        .audio-btn {
            background: linear-gradient(135deg, #5eb8d6 0%, #6495ed 100%);
            color: white;
            border: none;
            padding: 16px 36px;
            border-radius: 16px;
            font-size: 1.05em;
            cursor: pointer;
            margin: 20px 0;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 6px 24px rgba(94, 184, 214, 0.35);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 600;
            position: relative;
            overflow: hidden;
        }

        .audio-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.5s, height 0.5s;
        }

        .audio-btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .audio-btn:hover {
            transform: translateY(-3px) scale(1.03);
            box-shadow: 0 10px 35px rgba(94, 184, 214, 0.45);
        }

        .audio-btn:active {
            transform: translateY(-1px) scale(1.01);
        }

        .progress-bar {
            width: 100%;
            height: 12px;
            background: #e8f4f8;
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #5eb8d6 0%, #6495ed 100%);
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .quiz-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            color: #5a6c7d;
            font-weight: 600;
        }

        .difficulty-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .difficulty-btn {
            background: white;
            color: #5a6c7d;
            border: 3px solid #d0e8f0;
            padding: 24px 16px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 600;
            font-size: 0.95em;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            position: relative;
            overflow: hidden;
            text-align: center;
        }

        .difficulty-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(94, 184, 214, 0.1), transparent);
            transition: left 0.5s;
        }

        .difficulty-btn:hover::before {
            left: 100%;
        }

        .difficulty-btn:hover {
            border-color: #7ec9e3;
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(94, 184, 214, 0.15);
        }

        .difficulty-btn.active {
            background: linear-gradient(135deg, #5eb8d6 0%, #6495ed 100%);
            color: white;
            border-color: #5eb8d6;
            box-shadow: 0 6px 25px rgba(94, 184, 214, 0.35);
            transform: translateY(-2px);
        }

        .difficulty-btn.active:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 35px rgba(94, 184, 214, 0.45);
        }

        .difficulty-btn small {
            display: block;
            margin-top: 6px;
            opacity: 0.85;
            font-size: 0.85em;
            font-weight: 500;
        }

        .column-selector {
            background: #e8f4f8;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
        }

        .column-selector h4 {
            color: #5eb8d6;
            margin-bottom: 15px;
            text-align: center;
        }

        .column-checkboxes {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 10px;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            padding: 12px;
            background: white;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .checkbox-label:hover {
            background: #f0f9fc;
            transform: translateX(5px);
            border-color: #b8dfe8;
        }

        .checkbox-label input {
            accent-color: #5eb8d6;
        }

        /* Quiz Screen Styles */
        .quiz-header {
            background: white;
            border-radius: 24px;
            padding: 28px 35px;
            margin-bottom: 20px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.08);
        }

        .quiz-char {
            font-size: 9em;
            color: #5eb8d6;
            margin: 50px 0 40px 0;
            font-weight: 500;
            text-shadow: 0 6px 16px rgba(94, 184, 214, 0.25);
            animation: charFadeIn 0.5s ease;
        }

        @keyframes charFadeIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        input[type="text"] {
            width: 100%;
            padding: 24px 28px;
            font-size: 1.8em;
            border: 3px solid #d0e8f0;
            border-radius: 20px;
            text-align: center;
            margin-bottom: 24px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: white;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.04);
            font-weight: 500;
            color: #5a6c7d;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: #5eb8d6;
            box-shadow: 0 0 0 5px rgba(94, 184, 214, 0.12), 0 6px 25px rgba(94, 184, 214, 0.2);
            transform: translateY(-2px);
        }

        input[type="text"]::placeholder {
            color: #b8d5e2;
            font-weight: 400;
        }

        .quiz-actions {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 12px;
            margin-bottom: 24px;
        }

        .feedback {
            padding: 28px 32px;
            border-radius: 20px;
            margin-top: 24px;
            font-size: 1.5em;
            font-weight: 700;
            text-align: center;
            animation: feedbackPop 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
        }

        @keyframes feedbackPop {
            0% {
                transform: scale(0.85) translateY(20px);
                opacity: 0;
            }
            50% {
                transform: scale(1.02);
            }
            100% {
                transform: scale(1) translateY(0);
                opacity: 1;
            }
        }

        .feedback.correct {
            background: linear-gradient(135deg, #c8e6c9 0%, #a5d6a7 100%);
            color: #1b5e20;
            border: 3px solid #4caf50;
        }

        .feedback.wrong {
            background: linear-gradient(135deg, #ffcdd2 0%, #ef9a9a 100%);
            color: #b71c1c;
            border: 3px solid #f44336;
        }

        .results {
            text-align: center;
        }

        .trophy {
            font-size: 5em;
            margin: 20px 0;
        }

        .score {
            font-size: 3.5em;
            color: #5eb8d6;
            font-weight: bold;
            margin: 20px 0;
        }

        .mix-option {
            background: #e8f4f8;
            padding: 15px;
            border-radius: 12px;
            margin-top: 15px;
        }

        .mix-option label {
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-weight: 600;
            color: #5eb8d6;
        }

        .quiz-options {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
        }

        .quiz-option {
            flex: 1;
            text-align: center;
            padding: 22px 20px;
            background: white;
            border: 3px solid #d0e8f0;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 600;
            font-size: 0.95em;
            color: #5a6c7d;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            position: relative;
            overflow: hidden;
        }

        .quiz-option::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: radial-gradient(circle, rgba(94, 184, 214, 0.15) 0%, transparent 70%);
            transform: translate(-50%, -50%);
            transition: width 0.4s, height 0.4s;
            border-radius: 50%;
        }

        .quiz-option:hover::after {
            width: 300px;
            height: 300px;
        }

        .quiz-option:hover {
            border-color: #7ec9e3;
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(94, 184, 214, 0.15);
        }

        .quiz-option.active {
            background: linear-gradient(135deg, #5eb8d6 0%, #6495ed 100%);
            color: white;
            border-color: #5eb8d6;
            box-shadow: 0 6px 25px rgba(94, 184, 214, 0.35);
            transform: translateY(-2px);
        }

        .quiz-option.active:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 35px rgba(94, 184, 214, 0.45);
        }

        .quiz-option small {
            display: block;
            margin-top: 4px;
            opacity: 0.9;
            font-size: 0.85em;
            font-weight: 500;
        }

        /* Writing & Pronunciation Styles */
        .practice-header {
            text-align: center;
            margin: 30px 0;
        }

        .practice-target {
            font-size: 8em;
            color: #5eb8d6;
            margin-bottom: 16px;
            font-weight: 500;
            text-shadow: 0 6px 16px rgba(94, 184, 214, 0.25);
        }

        .practice-romaji {
            font-size: 2.2em;
            color: #6495ed;
            margin-bottom: 24px;
            font-weight: 600;
            letter-spacing: 0.05em;
        }

        .writing-canvas {
            border: 3px solid #d0e8f0;
            border-radius: 24px;
            cursor: crosshair;
            touch-action: none;
            background: white;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.06);
            transition: all 0.3s ease;
        }

        .writing-canvas:hover {
            border-color: #7ec9e3;
            box-shadow: 0 8px 28px rgba(94, 184, 214, 0.15);
        }

        .canvas-controls {
            display: flex;
            gap: 12px;
            margin-top: 20px;
            justify-content: center;
        }

        .canvas-btn {
            padding: 14px 28px;
            border: 3px solid #5eb8d6;
            background: white;
            color: #5eb8d6;
            border-radius: 16px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1em;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 12px rgba(94, 184, 214, 0.12);
        }

        .canvas-btn:hover {
            background: linear-gradient(135deg, #f0f9fc 0%, #e8f4f8 100%);
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(94, 184, 214, 0.25);
        }

        .canvas-btn:active {
            transform: translateY(-1px);
        }

        /* New Feature Screens */
        .feature-card {
            background: white;
            border-radius: 24px;
            padding: 40px;
            text-align: center;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.08);
        }

        .feature-icon {
            font-size: 5em;
            margin-bottom: 20px;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .feature-title {
            font-size: 2.2em;
            color: #5eb8d6;
            margin-bottom: 16px;
            font-weight: 700;
        }

        .feature-description {
            font-size: 1.1em;
            color: #7a8c9d;
            line-height: 1.6;
            margin-bottom: 30px;
        }

        /* Character Lookup Styles */
        .search-box {
            position: relative;
            margin-bottom: 30px;
        }

        .search-input {
            width: 100%;
            padding: 20px 24px 20px 56px;
            font-size: 1.2em;
            border: 3px solid #d0e8f0;
            border-radius: 20px;
            background: white;
            transition: all 0.3s ease;
            color: #5a6c7d;
            font-weight: 500;
        }

        .search-input:focus {
            outline: none;
            border-color: #5eb8d6;
            box-shadow: 0 0 0 5px rgba(94, 184, 214, 0.12);
        }

        .search-icon {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.5em;
            color: #b8d5e2;
        }

        .character-result {
            background: linear-gradient(135deg, #f0f9fc 0%, #e8f4f8 100%);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            border: 3px solid #d0e8f0;
        }

        .result-char {
            font-size: 8em;
            color: #5eb8d6;
            margin-bottom: 20px;
            text-shadow: 0 4px 12px rgba(94, 184, 214, 0.2);
        }

        .result-info {
            font-size: 1.8em;
            color: #6495ed;
            font-weight: 600;
            margin-bottom: 12px;
        }

        .result-tip {
            font-size: 1.1em;
            color: #7a8c9d;
            line-height: 1.6;
        }

        /* Daily Challenge Styles */
        .challenge-header {
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, #5eb8d6 0%, #6495ed 100%);
            border-radius: 24px;
            color: white;
            margin-bottom: 24px;
            box-shadow: 0 8px 30px rgba(94, 184, 214, 0.3);
        }

        .challenge-date {
            font-size: 1.1em;
            opacity: 0.9;
            margin-bottom: 8px;
        }

        .challenge-title {
            font-size: 2em;
            font-weight: 700;
            margin-bottom: 12px;
        }

        .challenge-streak {
            font-size: 1.3em;
            background: rgba(255, 255, 255, 0.2);
            padding: 12px 24px;
            border-radius: 16px;
            display: inline-block;
            backdrop-filter: blur(10px);
        }

        .challenge-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .challenge-item {
            background: white;
            border: 3px solid #d0e8f0;
            border-radius: 20px;
            padding: 24px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .challenge-item:hover {
            border-color: #5eb8d6;
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(94, 184, 214, 0.15);
        }

        .challenge-item.completed {
            background: linear-gradient(135deg, #c8e6c9 0%, #a5d6a7 100%);
            border-color: #4caf50;
        }

        .challenge-icon {
            font-size: 3em;
            margin-bottom: 12px;
        }

        .challenge-name {
            font-size: 1.1em;
            color: #5a6c7d;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .challenge-points {
            font-size: 0.95em;
            color: #5eb8d6;
            font-weight: 600;
        }

        /* Progress Styles */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: white;
            border: 3px solid #d0e8f0;
            border-radius: 20px;
            padding: 24px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }

        .stat-value {
            font-size: 2.5em;
            color: #5eb8d6;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .stat-label {
            font-size: 1em;
            color: #7a8c9d;
            font-weight: 600;
        }

        .progress-list {
            background: white;
            border-radius: 20px;
            padding: 28px;
            border: 3px solid #d0e8f0;
        }

        .progress-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 0;
            border-bottom: 2px solid #f0f8fb;
        }

        .progress-item:last-child {
            border-bottom: none;
        }

        .progress-item-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .progress-item-char {
            font-size: 2em;
            color: #5eb8d6;
            font-weight: 600;
        }

        .progress-item-name {
            font-size: 1.1em;
            color: #5a6c7d;
            font-weight: 600;
        }

        .progress-item-bar {
            flex: 1;
            max-width: 200px;
            height: 10px;
            background: #e8f4f8;
            border-radius: 8px;
            overflow: hidden;
            margin: 0 20px;
        }

        .progress-item-fill {
            height: 100%;
            background: linear-gradient(90deg, #5eb8d6, #6495ed);
            transition: width 0.3s ease;
        }

        .progress-item-percent {
            font-size: 1.2em;
            color: #5eb8d6;
            font-weight: 700;
            min-width: 60px;
            text-align: right;
        }

        @media (max-width: 768px) {
            .column-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            .difficulty-buttons {
                grid-template-columns: 1fr;
            }
            .practice-all-container {
                flex-direction: column;
            }
            .action-buttons {
                width: 100%;
                justify-content: space-around;
            }
            .stats-grid,
            .challenge-grid {
                grid-template-columns: 1fr;
            }
            .quiz-actions {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Menu Screen -->
        <div id="menu-screen">
            <div class="header">
                <h1>üåä Hiragana Harbor üåä</h1>
                <p>Sail through Japanese characters</p>
            </div>

            <div class="main-card">
                <div class="section-title">Learning Modules</div>
                <div class="column-grid" id="column-grid"></div>

                <div class="practice-all-container">
                    <div class="practice-all-btn" onclick="startStudy('all')">
                        <div class="title">Practice All Columns</div>
                        <div class="subtitle">Master all 46 Hiragana characters!</div>
                    </div>
                    <div class="action-buttons">
                        <div class="action-btn" onclick="startWritingPractice()">
                            <div class="icon">‚úçÔ∏è</div>
                            <div class="label">Writing<br>Practice</div>
                        </div>
                        <div class="action-btn" onclick="startPronunciationDrill()">
                            <div class="icon">üó£Ô∏è</div>
                            <div class="label">Pronunciation<br>Drill</div>
                        </div>
                        <div class="action-btn" onclick="showCharacterLookup()">
                            <div class="icon">üîç</div>
                            <div class="label">Character<br>Lookup</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="bottom-nav">
                <div class="nav-item" onclick="showDailyChallenge()">Daily Challenge</div>
                <div class="nav-item" onclick="showMyProgress()">My Progress</div>
            </div>
        </div>

        <!-- Study Screen -->
        <div id="study-screen" class="hidden">
            <div class="card">
                <button class="btn btn-secondary" onclick="backToMenu()">üè† Back to Menu</button>
            </div>

            <div class="card">
                <div class="section-title">üìö Character Walkthrough</div>
                <div class="quiz-info">
                    <span id="walkthrough-progress">Character 1 of 5</span>
                    <span id="walkthrough-column"></span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="walkthrough-progress-fill"></div>
                </div>

                <div class="walkthrough-container">
                    <div class="walkthrough-char" id="walkthrough-char">„ÅÇ</div>
                    <div class="walkthrough-romaji" id="walkthrough-romaji">a</div>
                    <button class="audio-btn" onclick="speakCharacter()">
                        üîä Listen to pronunciation
                    </button>
                    <div class="walkthrough-tip" id="walkthrough-tip">
                        This character represents the sound "a" as in "father"
                    </div>
                    <div style="display: flex; gap: 12px; margin-top: 30px;">
                        <button class="btn btn-secondary" id="prev-btn" onclick="previousChar()" style="flex: 1;">‚óÄ Previous</button>
                        <button class="btn" id="next-btn" onclick="nextChar()" style="flex: 1;">Next ‚ñ∂</button>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="section-title">üéØ Quiz Settings</div>
                
                <div class="difficulty-buttons">
                    <button class="difficulty-btn easy active" onclick="selectDifficulty('easy')">
                        üòä Easy<br><small>Single Characters</small>
                    </button>
                    <button class="difficulty-btn medium" onclick="selectDifficulty('medium')">
                        üòê Medium<br><small>2-Character Words</small>
                    </button>
                    <button class="difficulty-btn hard" onclick="selectDifficulty('hard')">
                        üò§ Hard<br><small>3-Character Words</small>
                    </button>
                    <button class="difficulty-btn sentence" onclick="selectDifficulty('sentence')">
                        üìù Sentences<br><small>Full Sentences</small>
                    </button>
                </div>

                <div class="quiz-options">
                    <div class="quiz-option active" id="finite-mode" onclick="selectQuizMode('finite')">
                        üìä Finite Quiz<br><small>15 questions</small>
                    </div>
                    <div class="quiz-option" id="infinite-mode" onclick="selectQuizMode('infinite')">
                        ‚àû Infinite Quiz<br><small>Keep going!</small>
                    </div>
                </div>

                <div id="mix-option" class="mix-option hidden">
                    <label>
                        <input type="checkbox" id="mix-columns-checkbox">
                        Mix with other hiragana columns
                    </label>
                </div>

                <div id="column-selector" class="column-selector hidden">
                    <h4>Select columns to mix:</h4>
                    <div class="column-checkboxes" id="column-checkboxes"></div>
                </div>

                <button class="btn" onclick="startQuiz()">üéØ Start Quiz</button>
            </div>
        </div>

        <!-- Quiz Screen -->
        <div id="quiz-screen" class="hidden">
            <div class="quiz-header">
                <div class="quiz-info">
                    <span id="question-num">Question 1 of 15</span>
                    <span id="score-display">Score: 0/15</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill"></div>
                </div>
            </div>

            <div class="card">
                <div style="text-align: center;">
                    <div class="quiz-char" id="quiz-char">„ÅÇ</div>
                    <button class="audio-btn" onclick="speakQuizCharacter()">
                        üîä Listen
                    </button>
                    <input type="text" id="answer-input" placeholder="Type the romaji..." autocomplete="off">
                    <div class="quiz-actions">
                        <button class="btn" id="submit-btn" onclick="submitAnswer()">‚úì Submit Answer</button>
                        <button class="btn btn-secondary" id="reveal-btn" onclick="revealAnswer()">üëÅÔ∏è Reveal</button>
                    </div>
                    <div id="feedback"></div>
                </div>
            </div>
        </div>

        <!-- Writing Practice Screen -->
        <div id="writing-screen" class="hidden">
            <div class="card">
                <button class="btn btn-secondary" onclick="backToMenu()">üè† Back to Menu</button>
            </div>

            <div class="card">
                <div class="section-title">‚úçÔ∏è Writing Practice</div>
                <div class="quiz-info">
                    <span id="writing-progress">Character 1</span>
                    <span id="writing-score">Score: 0</span>
                </div>
                
                <div class="practice-header">
                    <div class="practice-target" id="writing-target">„ÅÇ</div>
                    <div class="practice-romaji" id="writing-romaji">a</div>
                    <button class="audio-btn" onclick="speakWritingChar()">üîä Listen</button>
                </div>

                <div style="text-align: center;">
                    <canvas id="writing-canvas" class="writing-canvas" width="450" height="450"></canvas>
                    <div class="canvas-controls">
                        <button class="canvas-btn" onclick="clearCanvas()">üóëÔ∏è Clear</button>
                        <button class="canvas-btn" onclick="checkWriting()">‚úì Check</button>
                        <button class="canvas-btn" onclick="skipWriting()">‚è≠Ô∏è Skip</button>
                    </div>
                </div>
                <div id="writing-feedback"></div>
            </div>
        </div>

        <!-- Pronunciation Drill Screen -->
        <div id="pronunciation-screen" class="hidden">
            <div class="card">
                <button class="btn btn-secondary" onclick="backToMenu()">üè† Back to Menu</button>
            </div>

            <div class="card">
                <div class="section-title">üó£Ô∏è Pronunciation Drill</div>
                <div class="quiz-info">
                    <span id="pronunciation-progress">Round 1</span>
                    <span id="pronunciation-score">Score: 0</span>
                </div>
                
                <div class="practice-header">
                    <div class="practice-target" id="pronunciation-char">„ÅÇ</div>
                    <div class="practice-romaji" id="pronunciation-romaji">a</div>
                    
                    <button class="audio-btn" onclick="playPronunciationAudio()" style="font-size: 1.2em; padding: 18px 42px; margin-bottom: 30px;">
                        üîä Play Sound
                    </button>
                    
                    <div style="margin-top: 30px;">
                        <p style="color: #7a8c9d; margin-bottom: 24px; font-size: 1.15em; font-weight: 600;">Select the correct character:</p>
                        <div id="pronunciation-options" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; max-width: 450px; margin: 0 auto;">
                        </div>
                    </div>
                </div>
                <div id="pronunciation-feedback"></div>
            </div>
        </div>

        <!-- Results Screen -->
        <div id="results-screen" class="hidden">
            <div class="card results">
                <div class="trophy">üèÜ</div>
                <h2 style="color: #5eb8d6; font-size: 2em; margin-bottom: 20px;">Quiz Complete!</h2>
                <div class="score" id="final-score">0/0</div>
                <div style="font-size: 1.5em; color: #666; margin-bottom: 30px;" id="final-percentage">0% Correct</div>
                <button class="btn" onclick="retryQuiz()" style="margin-bottom: 15px;">üîÑ Try Again</button>
                <button class="btn btn-secondary" onclick="backToMenu()">üè† Back to Menu</button>
            </div>
        </div>

        <!-- Daily Challenge Screen -->
        <div id="challenge-screen" class="hidden">
            <div class="card">
                <button class="btn btn-secondary" onclick="backToMenu()">üè† Back to Menu</button>
            </div>

            <div class="challenge-header">
                <div class="challenge-date" id="challenge-date">Today's Date</div>
                <div class="challenge-title">‚ö° Daily Challenge</div>
                <div class="challenge-streak">üî• Streak: <span id="streak-count">0</span> days</div>
            </div>

            <div class="card">
                <div class="section-title">Today's Challenges</div>
                <div class="challenge-grid" id="challenge-grid">
                    <div class="challenge-item" onclick="alert('Challenge coming soon!')">
                        <div class="challenge-icon">üìù</div>
                        <div class="challenge-name">Quick Quiz</div>
                        <div class="challenge-points">+50 XP</div>
                    </div>
                    <div class="challenge-item" onclick="alert('Challenge coming soon!')">
                        <div class="challenge-icon">‚úçÔ∏è</div>
                        <div class="challenge-name">Write 5 Characters</div>
                        <div class="challenge-points">+30 XP</div>
                    </div>
                    <div class="challenge-item" onclick="alert('Challenge coming soon!')">
                        <div class="challenge-icon">üó£Ô∏è</div>
                        <div class="challenge-name">Pronunciation Practice</div>
                        <div class="challenge-points">+40 XP</div>
                    </div>
                </div>
            </div>

            <div class="feature-card">
                <div class="feature-icon">üéØ</div>
                <div class="feature-title">Keep Your Streak!</div>
                <div class="feature-description">Complete daily challenges to maintain your learning streak and earn rewards!</div>
            </div>
        </div>

        <!-- My Progress Screen -->
        <div id="progress-screen" class="hidden">
            <div class="card">
                <button class="btn btn-secondary" onclick="backToMenu()">üè† Back to Menu</button>
            </div>

            <div class="card">
                <div class="section-title">üìä Your Statistics</div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="total-learned">0</div>
                        <div class="stat-label">Characters Learned</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="quiz-taken">0</div>
                        <div class="stat-label">Quizzes Taken</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="accuracy-rate">0%</div>
                        <div class="stat-label">Accuracy Rate</div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="section-title">üìà Column Progress</div>
                <div class="progress-list" id="progress-list"></div>
            </div>
        </div>

        <!-- Character Lookup Screen -->
        <div id="lookup-screen" class="hidden">
            <div class="card">
                <button class="btn btn-secondary" onclick="backToMenu()">üè† Back to Menu</button>
            </div>

            <div class="card">
                <div class="section-title">üîç Character Lookup</div>
                <div class="search-box">
                    <span class="search-icon">üîé</span>
                    <input type="text" class="search-input" id="lookup-input" placeholder="Type romaji (e.g., 'ka', 'shi', 'tsu')" oninput="lookupCharacter()">
                </div>
                <div id="lookup-result"></div>
            </div>

            <div class="feature-card">
                <div class="feature-icon">üí°</div>
                <div class="feature-title">Quick Reference</div>
                <div class="feature-description">Type any romaji to instantly find the corresponding hiragana character and pronunciation tips!</div>
            </div>
        </div>
    </div>

    <script>
        const HIRAGANA = {
            a: { name: 'Vowels („ÅÇË°å)', chars: [
                ['„ÅÇ', 'a', 'Pronounced like "a" in "father"'],
                ['„ÅÑ', 'i', 'Pronounced like "ee" in "see"'],
                ['„ÅÜ', 'u', 'Pronounced like "oo" in "food"'],
                ['„Åà', 'e', 'Pronounced like "e" in "bed"'],
                ['„Åä', 'o', 'Pronounced like "o" in "go"']
            ]},
            k: { name: 'K Column („ÅãË°å)', chars: [
                ['„Åã', 'ka', 'Like "ka" in "car"'],
                ['„Åç', 'ki', 'Like "key"'],
                ['„Åè', 'ku', 'Like "coo"'],
                ['„Åë', 'ke', 'Like "keh" in "kept"'],
                ['„Åì', 'ko', 'Like "co" in "code"']
            ]},
            s: { name: 'S Column („ÅïË°å)', chars: [
                ['„Åï', 'sa', 'Like "sa" in "saw"'],
                ['„Åó', 'shi', 'Like "she"'],
                ['„Åô', 'su', 'Like "sue"'],
                ['„Åõ', 'se', 'Like "se" in "set"'],
                ['„Åù', 'so', 'Like "so" in "soap"']
            ]},
            t: { name: 'T Column („ÅüË°å)', chars: [
                ['„Åü', 'ta', 'Like "ta" in "taco"'],
                ['„Å°', 'chi', 'Like "chee" in "cheese"'],
                ['„Å§', 'tsu', 'Like "tsunami"'],
                ['„Å¶', 'te', 'Like "te" in "tennis"'],
                ['„Å®', 'to', 'Like "toe"']
            ]},
            n: { name: 'N Column („Å™Ë°å)', chars: [
                ['„Å™', 'na', 'Like "na" in "na na na"'],
                ['„Å´', 'ni', 'Like "knee"'],
                ['„Å¨', 'nu', 'Like "new"'],
                ['„Å≠', 'ne', 'Like "ne" in "net"'],
                ['„ÅÆ', 'no', 'Like "no"']
            ]},
            h: { name: 'H Column („ÅØË°å)', chars: [
                ['„ÅØ', 'ha', 'Like "ha" in "haha"'],
                ['„Å≤', 'hi', 'Like "he" in "heat"'],
                ['„Åµ', 'fu', 'Like blowing out a candle'],
                ['„Å∏', 'he', 'Like "he" in "hen"'],
                ['„Åª', 'ho', 'Like "ho" in "hope"']
            ]},
            m: { name: 'M Column („ÅæË°å)', chars: [
                ['„Åæ', 'ma', 'Like "ma" in "mama"'],
                ['„Åø', 'mi', 'Like "me"'],
                ['„ÇÄ', 'mu', 'Like "moo"'],
                ['„ÇÅ', 'me', 'Like "me" in "men"'],
                ['„ÇÇ', 'mo', 'Like "mo" in "most"']
            ]},
            y: { name: 'Y Column („ÇÑË°å)', chars: [
                ['„ÇÑ', 'ya', 'Like "ya" in "yacht"'],
                ['„ÇÜ', 'yu', 'Like "you"'],
                ['„Çà', 'yo', 'Like "yo"']
            ]},
            r: { name: 'R Column („ÇâË°å)', chars: [
                ['„Çâ', 'ra', 'Between "ra" and "la"'],
                ['„Çä', 'ri', 'Between "ree" and "lee"'],
                ['„Çã', 'ru', 'Between "roo" and "loo"'],
                ['„Çå', 're', 'Between "re" and "le"'],
                ['„Çç', 'ro', 'Between "ro" and "lo"']
            ]},
            w: { name: 'W Column („ÇèË°å)', chars: [
                ['„Çè', 'wa', 'Like "wa" in "water"'],
                ['„Çí', 'wo', 'Pronounced like "o"'],
                ['„Çì', 'n', 'Like "n" in "sing"']
            ]}
        };

        const VOWEL_WORDS = {
            medium: [
                ['„ÅÇ„ÅÑ', 'ai'], ['„ÅÑ„ÅÜ', 'iu'], ['„ÅÜ„Åà', 'ue'], ['„Åà„ÅÑ', 'ei'], 
                ['„Åä„ÅÑ', 'oi'], ['„ÅÑ„Åà', 'ie'], ['„ÅÇ„Åä', 'ao'], ['„ÅÜ„Åä', 'uo']
            ],
            hard: [
                ['„ÅÇ„Åä„ÅÑ', 'aoi'], ['„ÅÑ„ÅÜ„Åà', 'iue'], ['„Åä„ÅÑ„Åä„ÅÑ', 'oioi'], 
                ['„ÅÇ„ÅÑ„ÅÜ', 'aiu'], ['„ÅÜ„Åà„Åä', 'ueo']
            ]
        };

        const SENTENCES = [
            ['„Åì„Çì„Å´„Å°„ÅØ', 'konnichiwa', 'Hello'],
            ['„ÅÇ„Çä„Åå„Å®„ÅÜ', 'arigatou', 'Thank you'],
            ['„Åï„Çà„ÅÜ„Å™„Çâ', 'sayounara', 'Goodbye'],
            ['„Åä„ÅØ„Çà„ÅÜ', 'ohayou', 'Good morning'],
            ['„Åô„Åø„Åæ„Åõ„Çì', 'sumimasen', 'Excuse me']
        ];

        let currentColumn = null;
        let currentDifficulty = 'easy';
        let quizMode = 'finite';
        let quizData = [];
        let currentQuestion = 0;
        let score = 0;
        let walkthroughChars = [];
        let walkthroughIndex = 0;
        let columnProgress = {};
        let selectedColumns = new Set();
        let canvas, ctx;
        let isDrawing = false;
        let writingData = [];
        let writingIndex = 0;
        let writingScore = 0;
        let pronunciationData = [];
        let pronunciationIndex = 0;
        let pronunciationScore = 0;

        function getAllChars() {
            let all = [];
            Object.values(HIRAGANA).forEach(col => {
                col.chars.forEach(char => all.push([char[0], char[1]]));
            });
            return all;
        }

        function speakCharacter() {
            const romaji = document.getElementById('walkthrough-romaji').textContent;
            const utterance = new SpeechSynthesisUtterance(romaji);
            utterance.lang = 'ja-JP';
            utterance.rate = 0.7;
            speechSynthesis.speak(utterance);
        }

        function speakQuizCharacter() {
            const [char, romaji] = quizData[currentQuestion];
            const utterance = new SpeechSynthesisUtterance(romaji);
            utterance.lang = 'ja-JP';
            utterance.rate = 0.7;
            speechSynthesis.speak(utterance);
        }

        function speakWritingChar() {
            const romaji = document.getElementById('writing-romaji').textContent;
            const utterance = new SpeechSynthesisUtterance(romaji);
            utterance.lang = 'ja-JP';
            utterance.rate = 0.7;
            speechSynthesis.speak(utterance);
        }

        function loadProgress() {
            const saved = localStorage.getItem('hiragana_progress');
            if (saved) {
                columnProgress = JSON.parse(saved);
            } else {
                Object.keys(HIRAGANA).forEach(key => {
                    columnProgress[key] = { easy: 0, medium: 0, hard: 0, sentence: 0 };
                });
                columnProgress['all'] = { easy: 0, medium: 0, hard: 0, sentence: 0 };
            }
        }

        function saveProgress() {
            localStorage.setItem('hiragana_progress', JSON.stringify(columnProgress));
        }

        function updateColumnProgress(column, difficulty, percentage) {
            if (!columnProgress[column]) {
                columnProgress[column] = { easy: 0, medium: 0, hard: 0, sentence: 0 };
            }
            if (percentage > columnProgress[column][difficulty]) {
                columnProgress[column][difficulty] = percentage;
                saveProgress();
            }
        }

        function getColumnCompletion(column) {
            if (!columnProgress[column]) return 0;
            const prog = columnProgress[column];
            return Math.round((prog.easy + prog.medium + prog.hard + prog.sentence) / 4);
        }

        function getRandomChar(chars) {
            return chars[Math.floor(Math.random() * chars.length)];
        }

        function generateRandomWords(baseChars, allChars, count, wordLength) {
            const words = [];
            const usedWords = new Set();
            
            for (let i = 0; i < count * 3 && words.length < count; i++) {
                let chars = [];
                let romaji = [];
                
                const firstChar = getRandomChar(baseChars);
                chars.push(firstChar[0]);
                romaji.push(firstChar[1]);
                
                for (let j = 1; j < wordLength; j++) {
                    const randomChar = getRandomChar(allChars);
                    chars.push(randomChar[0]);
                    romaji.push(randomChar[1]);
                }
                
                const word = chars.join('');
                const reading = romaji.join('');
                
                if (!usedWords.has(word)) {
                    words.push([word, reading]);
                    usedWords.add(word);
                }
            }
            
            return words;
        }

        function getSelectedColumnsChars() {
            let chars = [];
            selectedColumns.forEach(key => {
                HIRAGANA[key].chars.forEach(char => {
                    chars.push([char[0], char[1]]);
                });
            });
            return chars;
        }

        function generateWords(columnKey, difficulty) {
            let words = [];
            const mixWithOthers = document.getElementById('mix-columns-checkbox').checked;
            
            if (difficulty === 'sentence') {
                words = [...SENTENCES];
            } else if (columnKey === 'a') {
                if (difficulty === 'easy') {
                    words = HIRAGANA[columnKey].chars.map(c => [c[0], c[1]]);
                } else if (difficulty === 'medium') {
                    words = [...VOWEL_WORDS.medium];
                } else if (difficulty === 'hard') {
                    words = [...VOWEL_WORDS.hard];
                }
            } else {
                if (difficulty === 'easy') {
                    if (columnKey === 'all') {
                        words = getAllChars();
                    } else {
                        words = HIRAGANA[columnKey].chars.map(c => [c[0], c[1]]);
                    }
                } else if (difficulty === 'medium' || difficulty === 'hard') {
                    const wordLength = difficulty === 'medium' ? 2 : 3;
                    const columnChars = columnKey === 'all' ? getAllChars() : HIRAGANA[columnKey].chars.map(c => [c[0], c[1]]);
                    
                    let availableChars;
                    if (mixWithOthers && selectedColumns.size > 0) {
                        availableChars = getSelectedColumnsChars();
                    } else if (mixWithOthers) {
                        availableChars = getAllChars();
                    } else {
                        availableChars = columnChars;
                    }
                    
                    words = generateRandomWords(columnChars, availableChars, 30, wordLength);
                }
            }
            
            return words;
        }

        function initMenu() {
            loadProgress();
            const grid = document.getElementById('column-grid');
            grid.innerHTML = '';

            Object.entries(HIRAGANA).forEach(([key, data]) => {
                const completion = getColumnCompletion(key);
                const card = document.createElement('div');
                card.className = 'column-card';
                card.onclick = () => startStudy(key);
                
                let completionHTML = '';
                if (completion > 0) {
                    if (completion === 100) {
                        completionHTML = '<div class="completion-badge">‚úì Complete</div>';
                    } else {
                        completionHTML = `
                            <div class="progress-mini">
                                <div class="progress-mini-fill" style="width: ${completion}%"></div>
                            </div>
                            <div class="progress-text">${completion}%</div>
                        `;
                    }
                }
                
                card.innerHTML = `
                    <div class="char">${data.chars[0][0]}</div>
                    <div class="name">${data.name}</div>
                    <div class="count">${data.chars.length} characters</div>
                    ${completionHTML}
                `;
                grid.appendChild(card);
            });
        }

        function showScreen(screenId) {
            document.querySelectorAll('[id$="-screen"]').forEach(s => s.classList.add('hidden'));
            document.getElementById(screenId).classList.remove('hidden');
        }

        function selectDifficulty(level) {
            currentDifficulty = level;
            document.querySelectorAll('.difficulty-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.closest('.difficulty-btn').classList.add('active');
            
            const mixOption = document.getElementById('mix-option');
            const columnSelector = document.getElementById('column-selector');
            
            if (level === 'medium' || level === 'hard') {
                mixOption.classList.remove('hidden');
                if (document.getElementById('mix-columns-checkbox').checked) {
                    columnSelector.classList.remove('hidden');
                }
            } else {
                mixOption.classList.add('hidden');
                columnSelector.classList.add('hidden');
            }
        }

        function selectQuizMode(mode) {
            quizMode = mode;
            document.querySelectorAll('.quiz-option').forEach(option => {
                option.classList.remove('active');
            });
            document.getElementById(`${mode}-mode`).classList.add('active');
        }

        function startStudy(column) {
            currentColumn = column;
            currentDifficulty = 'easy';
            quizMode = 'finite';
            walkthroughIndex = 0;
            selectedColumns.clear();
            showScreen('study-screen');

            document.querySelectorAll('.difficulty-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector('.difficulty-btn.easy').classList.add('active');

            document.querySelectorAll('.quiz-option').forEach(option => {
                option.classList.remove('active');
            });
            document.getElementById('finite-mode').classList.add('active');

            if (column === 'all') {
                walkthroughChars = getAllChars().map(c => [...c, 'Practice this character']);
            } else {
                walkthroughChars = HIRAGANA[column].chars;
                document.getElementById('walkthrough-column').textContent = HIRAGANA[column].name;
            }

            updateWalkthrough();
            setupColumnSelector();
        }

        function setupColumnSelector() {
            const container = document.getElementById('column-checkboxes');
            container.innerHTML = '';
            
            Object.entries(HIRAGANA).forEach(([key, data]) => {
                const label = document.createElement('label');
                label.className = 'checkbox-label';
                label.innerHTML = `
                    <input type="checkbox" value="${key}" onchange="toggleColumn('${key}')">
                    <span>${data.name}</span>
                `;
                container.appendChild(label);
            });

            document.getElementById('mix-columns-checkbox').onchange = function() {
                const selector = document.getElementById('column-selector');
                if (this.checked && (currentDifficulty === 'medium' || currentDifficulty === 'hard')) {
                    selector.classList.remove('hidden');
                } else {
                    selector.classList.add('hidden');
                }
            };
        }

        function toggleColumn(key) {
            if (selectedColumns.has(key)) {
                selectedColumns.delete(key);
            } else {
                selectedColumns.add(key);
            }
        }

        function updateWalkthrough() {
            const [char, romaji, tip] = walkthroughChars[walkthroughIndex];
            
            document.getElementById('walkthrough-char').textContent = char;
            document.getElementById('walkthrough-romaji').textContent = romaji;
            document.getElementById('walkthrough-tip').textContent = tip;
            document.getElementById('walkthrough-progress').textContent = 
                `Character ${walkthroughIndex + 1} of ${walkthroughChars.length}`;
            document.getElementById('walkthrough-progress-fill').style.width = 
                `${((walkthroughIndex + 1) / walkthroughChars.length) * 100}%`;

            document.getElementById('prev-btn').disabled = walkthroughIndex === 0;
            document.getElementById('next-btn').textContent = 
                walkthroughIndex === walkthroughChars.length - 1 ? 'üéâ Complete' : 'Next ‚ñ∂';
        }

        function previousChar() {
            if (walkthroughIndex > 0) {
                walkthroughIndex--;
                updateWalkthrough();
            }
        }

        function nextChar() {
            if (walkthroughIndex < walkthroughChars.length - 1) {
                walkthroughIndex++;
                updateWalkthrough();
            } else {
                document.querySelector('.section-title').scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'center' 
                });
            }
        }

        function startQuiz() {
            const words = generateWords(currentColumn, currentDifficulty);
            
            if (quizMode === 'finite') {
                quizData = [...words].sort(() => Math.random() - 0.5).slice(0, 15);
            } else {
                quizData = [...words].sort(() => Math.random() - 0.5).slice(0, 15);
            }
            
            currentQuestion = 0;
            score = 0;

            showScreen('quiz-screen');
            updateQuiz();
        }

        function updateQuiz() {
            if (quizMode === 'finite') {
                document.getElementById('question-num').textContent = 
                    `Question ${currentQuestion + 1} of ${quizData.length}`;
            } else {
                document.getElementById('question-num').textContent = 
                    `Question ${currentQuestion + 1} (‚àû)`;
            }
            
            document.getElementById('score-display').textContent = 
                `Score: ${score}/${currentQuestion}`;
            
            if (quizMode === 'finite') {
                document.getElementById('progress-fill').style.width = 
                    `${((currentQuestion + 1) / quizData.length) * 100}%`;
            } else {
                document.getElementById('progress-fill').style.width = 
                    `${((currentQuestion % 15) / 15) * 100}%`;
            }
            
            document.getElementById('quiz-char').textContent = quizData[currentQuestion][0];
            document.getElementById('answer-input').value = '';
            document.getElementById('answer-input').disabled = false;
            document.getElementById('submit-btn').disabled = false;
            document.getElementById('reveal-btn').disabled = false;
            document.getElementById('feedback').innerHTML = '';
            document.getElementById('answer-input').focus();
        }

        function revealAnswer() {
            const [char, correct] = quizData[currentQuestion];
            
            document.getElementById('answer-input').disabled = true;
            document.getElementById('submit-btn').disabled = true;
            document.getElementById('reveal-btn').disabled = true;

            const feedback = document.getElementById('feedback');
            feedback.className = 'feedback wrong';
            feedback.innerHTML = `The answer is: <strong>${correct}</strong>`;

            setTimeout(() => {
                nextQuestion();
            }, 1500);
        }

        function submitAnswer() {
            const input = document.getElementById('answer-input');
            const answer = input.value.toLowerCase().trim();
            const [char, correct] = quizData[currentQuestion];
            const isCorrect = answer === correct;

            if (isCorrect) score++;

            input.disabled = true;
            document.getElementById('submit-btn').disabled = true;
            document.getElementById('reveal-btn').disabled = true;

            const feedback = document.getElementById('feedback');
            feedback.className = `feedback ${isCorrect ? 'correct' : 'wrong'}`;
            feedback.innerHTML = isCorrect 
                ? '‚úì Correct!' 
                : `‚úó Wrong! The correct answer is: <strong>${correct}</strong>`;

            setTimeout(() => {
                nextQuestion();
            }, 1500);
        }

        function nextQuestion() {
            if (quizMode === 'finite') {
                if (currentQuestion + 1 < quizData.length) {
                    currentQuestion++;
                    updateQuiz();
                } else {
                    showResults();
                }
            } else {
                currentQuestion++;
                
                if (currentQuestion >= quizData.length - 5) {
                    const moreWords = generateWords(currentColumn, currentDifficulty);
                    quizData.push(...moreWords.sort(() => Math.random() - 0.5).slice(0, 10));
                }
                
                updateQuiz();
            }
        }

        function showResults() {
            showScreen('results-screen');
            const percentage = Math.round((score / quizData.length) * 100);
            document.getElementById('final-score').textContent = `${score}/${quizData.length}`;
            document.getElementById('final-percentage').textContent = `${percentage}% Correct`;
            
            updateColumnProgress(currentColumn, currentDifficulty, percentage);
        }

        function retryQuiz() {
            startQuiz();
        }

        function backToMenu() {
            showScreen('menu-screen');
            initMenu();
        }

        function startWritingPractice() {
            showScreen('writing-screen');
            writingData = getAllChars().sort(() => Math.random() - 0.5);
            writingIndex = 0;
            writingScore = 0;
            
            canvas = document.getElementById('writing-canvas');
            ctx = canvas.getContext('2d');
            
            setupCanvas();
            updateWritingPractice();
        }

        function setupCanvas() {
            ctx.strokeStyle = '#5eb8d6';
            ctx.lineWidth = 8;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);
            
            canvas.addEventListener('touchstart', handleTouch);
            canvas.addEventListener('touchmove', handleTouch);
            canvas.addEventListener('touchend', stopDrawing);
        }

        function startDrawing(e) {
            isDrawing = true;
            const rect = canvas.getBoundingClientRect();
            ctx.beginPath();
            ctx.moveTo(e.clientX - rect.left, e.clientY - rect.top);
        }

        function draw(e) {
            if (!isDrawing) return;
            const rect = canvas.getBoundingClientRect();
            ctx.lineTo(e.clientX - rect.left, e.clientY - rect.top);
            ctx.stroke();
        }

        function stopDrawing() {
            isDrawing = false;
        }

        function handleTouch(e) {
            e.preventDefault();
            const touch = e.touches[0];
            const mouseEvent = new MouseEvent(e.type === 'touchstart' ? 'mousedown' : 'mousemove', {
                clientX: touch.clientX,
                clientY: touch.clientY
            });
            canvas.dispatchEvent(mouseEvent);
        }

        function clearCanvas() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }

        function updateWritingPractice() {
            const [char, romaji] = writingData[writingIndex];
            document.getElementById('writing-target').textContent = char;
            document.getElementById('writing-romaji').textContent = romaji;
            document.getElementById('writing-progress').textContent = `Character ${writingIndex + 1}`;
            document.getElementById('writing-score').textContent = `Score: ${writingScore}`;
            document.getElementById('writing-feedback').innerHTML = '';
            clearCanvas();
        }

        function checkWriting() {
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const pixels = imageData.data;
            let drawnPixels = 0;
            
            for (let i = 3; i < pixels.length; i += 4) {
                if (pixels[i] > 0) drawnPixels++;
            }
            
            const feedback = document.getElementById('writing-feedback');
            
            if (drawnPixels < 200) {
                feedback.className = 'feedback wrong';
                feedback.innerHTML = '‚úó Please draw the character first!';
                return;
            }
            
            writingScore++;
            feedback.className = 'feedback correct';
            feedback.innerHTML = '‚úì Great attempt! Keep practicing!';
            
            setTimeout(() => {
                skipWriting();
            }, 1500);
        }

        function skipWriting() {
            writingIndex++;
            if (writingIndex < writingData.length) {
                updateWritingPractice();
            } else {
                const feedback = document.getElementById('writing-feedback');
                feedback.className = 'feedback correct';
                feedback.innerHTML = `üéâ Practice Complete! Score: ${writingScore}/${writingData.length}`;
                setTimeout(() => backToMenu(), 2000);
            }
        }

        // Daily Challenge Functions
        function showDailyChallenge() {
            showScreen('challenge-screen');
            const today = new Date().toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
            document.getElementById('challenge-date').textContent = today;
            
            const streak = parseInt(localStorage.getItem('daily_streak') || '0');
            document.getElementById('streak-count').textContent = streak;
        }

        // My Progress Functions
        function showMyProgress() {
            showScreen('progress-screen');
            updateProgressStats();
        }

        function updateProgressStats() {
            let totalLearned = 0;
            let totalQuizzes = parseInt(localStorage.getItem('total_quizzes') || '0');
            let totalCorrect = parseInt(localStorage.getItem('total_correct') || '0');
            let totalAnswers = parseInt(localStorage.getItem('total_answers') || '0');
            
            Object.values(columnProgress).forEach(prog => {
                if (prog.easy > 0) totalLearned++;
            });
            
            document.getElementById('total-learned').textContent = totalLearned;
            document.getElementById('quiz-taken').textContent = totalQuizzes;
            
            const accuracy = totalAnswers > 0 ? Math.round((totalCorrect / totalAnswers) * 100) : 0;
            document.getElementById('accuracy-rate').textContent = accuracy + '%';
            
            const progressList = document.getElementById('progress-list');
            progressList.innerHTML = '';
            
            Object.entries(HIRAGANA).forEach(([key, data]) => {
                const completion = getColumnCompletion(key);
                const item = document.createElement('div');
                item.className = 'progress-item';
                item.innerHTML = `
                    <div class="progress-item-left">
                        <div class="progress-item-char">${data.chars[0][0]}</div>
                        <div class="progress-item-name">${data.name}</div>
                    </div>
                    <div class="progress-item-bar">
                        <div class="progress-item-fill" style="width: ${completion}%"></div>
                    </div>
                    <div class="progress-item-percent">${completion}%</div>
                `;
                progressList.appendChild(item);
            });
        }

        // Character Lookup Functions
        function showCharacterLookup() {
            showScreen('lookup-screen');
            document.getElementById('lookup-input').value = '';
            document.getElementById('lookup-result').innerHTML = '';
        }

        function lookupCharacter() {
            const input = document.getElementById('lookup-input').value.toLowerCase().trim();
            const result = document.getElementById('lookup-result');
            
            if (!input) {
                result.innerHTML = '';
                return;
            }
            
            let found = null;
            Object.values(HIRAGANA).forEach(col => {
                col.chars.forEach(char => {
                    if (char[1].toLowerCase() === input) {
                        found = char;
                    }
                });
            });
            
            if (found) {
                result.innerHTML = `
                    <div class="character-result">
                        <div class="result-char">${found[0]}</div>
                        <div class="result-info">${found[1]}</div>
                        <button class="audio-btn" onclick="speakRomaji('${found[1]}')" style="margin: 20px auto;">
                            üîä Listen to pronunciation
                        </button>
                        <div class="result-tip">${found[2]}</div>
                    </div>
                `;
            } else {
                result.innerHTML = `
                    <div class="character-result" style="border-color: #ffcdd2;">
                        <div class="result-info" style="color: #f44336;">Character not found</div>
                        <div class="result-tip">Try searching for: a, ka, sa, ta, na, ha, ma, ya, ra, wa, shi, chi, tsu, etc.</div>
                    </div>
                `;
            }
        }

        function speakRomaji(romaji) {
            const utterance = new SpeechSynthesisUtterance(romaji);
            utterance.lang = 'ja-JP';
            utterance.rate = 0.7;
            speechSynthesis.speak(utterance);
        }

        function showResults() {
            showScreen('results-screen');
            const percentage = Math.round((score / quizData.length) * 100);
            document.getElementById('final-score').textContent = `${score}/${quizData.length}`;
            document.getElementById('final-percentage').textContent = `${percentage}% Correct`;
            
            updateColumnProgress(currentColumn, currentDifficulty, percentage);
            
            const totalQuizzes = parseInt(localStorage.getItem('total_quizzes') || '0') + 1;
            const totalCorrect = parseInt(localStorage.getItem('total_correct') || '0') + score;
            const totalAnswers = parseInt(localStorage.getItem('total_answers') || '0') + quizData.length;
            
            localStorage.setItem('total_quizzes', totalQuizzes);
            localStorage.setItem('total_correct', totalCorrect);
            localStorage.setItem('total_answers', totalAnswers);
        }

        function startPronunciationDrill() {
            showScreen('pronunciation-screen');
            pronunciationData = getAllChars().sort(() => Math.random() - 0.5);
            pronunciationIndex = 0;
            pronunciationScore = 0;
            updatePronunciationDrill();
        }

        function updatePronunciationDrill() {
            const [char, romaji] = pronunciationData[pronunciationIndex];
            document.getElementById('pronunciation-char').textContent = char;
            document.getElementById('pronunciation-romaji').textContent = romaji;
            document.getElementById('pronunciation-progress').textContent = `Round ${pronunciationIndex + 1}`;
            document.getElementById('pronunciation-score').textContent = `Score: ${pronunciationScore}`;
            document.getElementById('pronunciation-feedback').innerHTML = '';
            
            generatePronunciationOptions(char);
        }

        function generatePronunciationOptions(correctChar) {
            const allChars = getAllChars();
            const options = [correctChar];
            
            while (options.length < 4) {
                const randomChar = allChars[Math.floor(Math.random() * allChars.length)][0];
                if (!options.includes(randomChar)) {
                    options.push(randomChar);
                }
            }
            
            options.sort(() => Math.random() - 0.5);
            
            const container = document.getElementById('pronunciation-options');
            container.innerHTML = '';
            
            options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'difficulty-btn';
                btn.style.fontSize = '3em';
                btn.style.padding = '30px';
                btn.textContent = opt;
                btn.onclick = () => checkPronunciation(opt, correctChar);
                container.appendChild(btn);
            });
        }

        function playPronunciationAudio() {
            const romaji = document.getElementById('pronunciation-romaji').textContent;
            const utterance = new SpeechSynthesisUtterance(romaji);
            utterance.lang = 'ja-JP';
            utterance.rate = 0.7;
            speechSynthesis.speak(utterance);
        }

        function checkPronunciation(selected, correct) {
            const isCorrect = selected === correct;
            if (isCorrect) pronunciationScore++;
            
            const feedback = document.getElementById('pronunciation-feedback');
            feedback.className = `feedback ${isCorrect ? 'correct' : 'wrong'}`;
            feedback.innerHTML = isCorrect 
                ? '‚úì Correct!' 
                : `‚úó Wrong! The correct answer was: <strong>${correct}</strong>`;
            
            setTimeout(() => {
                pronunciationIndex++;
                if (pronunciationIndex < pronunciationData.length) {
                    updatePronunciationDrill();
                } else {
                    feedback.className = 'feedback correct';
                    feedback.innerHTML = `üéâ Drill Complete! Score: ${pronunciationScore}/${pronunciationData.length}`;
                    setTimeout(() => backToMenu(), 2000);
                }
            }, 1500);
        }

        document.getElementById('answer-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !document.getElementById('submit-btn').disabled) {
                submitAnswer();
            }
        });

        initMenu();
    </script>
</body>
</html>
